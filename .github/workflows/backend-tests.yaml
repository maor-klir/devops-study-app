name: Backend Tests

on:
  pull_request:

jobs:
  check_paths:
    name: Check Paths
    runs-on: ubuntu-latest
    outputs:
      should_run: ${{ steps.filter.outputs.backend }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Conditional execution based on modified files on pull request
        uses: dorny/paths-filter@v3.0.2
        id: filter
        with:
          filters: |
            backend:
              - "src/backend/**"
              - ".github/workflows/backend-tests.yaml"
  test:
    name: Test Backend
    needs: check_paths
    if : ${{ needs.check_paths.outputs.should_run == "true" }}
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./src/backend
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Install UV
        uses: astral-sh/setup-uv@v5
      - name: Set up Python
        run: uv python install
      - name: Install dependencies
        run: |
          uv sync --locked --dev
      - name: Ruff linting
        run: |
          uv run ruff check --output-format=github --target-version=py313 src tests
          uv ruff format --diff --check --target-version=py313 src tests


